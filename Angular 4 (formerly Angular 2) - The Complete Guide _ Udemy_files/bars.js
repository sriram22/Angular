var _GAPageTools={readyStateCheckInterval:false,pagedata:false,sendMessage:function(action,data){var info={"id":_GAData.id,"actionId":_GAData.actionId,"hostname":_GAData.hostname,"location":document.location,"action":action,"data":data};var target=window.postMessage?window:(window.document.postMessage?window.document:undefined);if(typeof target!="undefined")
target.postMessage("GA_message:"+JSON.stringify(info),"*");},getCss:function(ElementId,CssProperty){if(document.getElementById(ElementId).currentStyle){var convertToCamelCase=CssProperty.replace(/\-(.)/g,function(m,l){return l.toUpperCase();});return document.getElementById(ElementId).currentStyle[convertToCamelCase];}else if(window.getComputedStyle){var elementStyle=window.getComputedStyle(document.getElementById(ElementId),"");return elementStyle.getPropertyValue(CssProperty);}
return false;},addLoadEvent:function(func){var oldonload=window.onload;if(typeof window.onload!='function'){window.onload=func;}else{window.onload=function(){if(oldonload){oldonload();}
func();};}},ping:function(what){var tmp={"method":what,"url":document.location.href};_GAPageTools.sendMessage("ping",tmp);},setState:function(what){_GAPageTools.sendMessage("setState",what);},putData:function(key,value){localStorage.setItem(key,value);},getData:function(key,fatal){var tmp;tmp=localStorage.getItem(key);if(tmp&&fatal)
localStorage.removeItem(key);return tmp;},putSessionData:function(key,value){sessionStorage.setItem(key,value);},getSessionData:function(key,fatal){var tmp;tmp=sessionStorage.getItem(key);if(tmp&&fatal)
sessionStorage.removeItem(key);return tmp;},redirect:function(url){_GAPageTools.sendMessage("redirect",url);},getGAStorage:function(sid,key){var storage=JSON.parse(localStorage.getItem('_GABarsStorage'));if(storage[sid]&&storage[sid][key]){return storage[sid][key];}},putGAStorage:function(sid,key,val){var storage={};var newItem={};storage[sid]=newItem;newItem[key]=val;localStorage.setItem('_GABarsStorage',JSON.stringify(storage));},injectOverlay:function(){if(!document.getElementById("_GAOverlay")){var overlay=_GAPageTools.createHtml("<div id='_GAOverlay' name='_GAOverlay' "+"style='position:fixed;top:0;left:0;width:100%;height:100%;background-color:#000;"+"filter:alpha(opacity=70);-moz-opacity:0.7;-khtml-opacity:0.7;opacity:0.7;z-index:2147483640;'></div>");document.body.insertBefore(overlay,document.body.childNodes[0]);}},injectLoader:function(){if(!document.getElementById("_GALoader")){var loader=_GAPageTools.createHtml("<iframe src='https://product.givingassistant.org/addon/v5.3.0/inject/bars/loader.html' id='_GALoader' name='_GALoader' allowTransparency='true' scrolling='no' "+"style='margin: 0; padding: 0; border: 0; position: fixed; top: 0px; right: 0px; "+"overflow: hidden; z-index: 2147483646; transition:opacity 0.2s; opacity:1;"+"background-color: transparent; display: block !important; width:100%; height:100%;'></iframe>");document.body.insertBefore(loader,document.body.childNodes[0]);}},injectBar:function(url,style){if(!document.getElementById("_GANotification")){var iframe=_GAPageTools.createHtml("<iframe src='"+url+"' id='_GANotification' name='_GANotification' allowTransparency='true' scrolling='no' "+"style='margin: 0; padding: 0; border: 0; position: fixed; top: 0px; right: 0px; "+"overflow: hidden; z-index: 2147483646; transition:opacity 0.2s; opacity:1;"+"background-color: transparent; display: block !important;  "+style+"'></iframe>");document.body.insertBefore(iframe,document.body.childNodes[0]);}},dropBar:function(height,shadow){if(!document.getElementById("_GANotification"))
return;var bar=document.getElementById("_GANotification");if(_GAPageTools.getCss("_GANotification","top")>-1)
return;if(shadow){bar.style.boxShadow="0px 0px 15px #555";bar.style.mozBoxShadow="0px 0px 15px #555";bar.style.webkitBoxShadow="0px 0px 15px #555";}
bar.style.webkitTransition="all .4s ease-out";bar.style.mozTransition="all .4s ease-out";bar.style.transition="all .4s ease-out";bar.style.top=height+"px";},changeBarHeight:function(height){if(!document.getElementById("_GANotification"))
return;var bar=document.getElementById("_GANotification");bar.style.height=height;},closeBar:function(id){var id=id||"_GANotification";if(!document.getElementById(id)){return;}
var bar=document.getElementById(id);bar.parentNode.removeChild(bar);},createHtml:function(htmlStr){var frag=document.createDocumentFragment(),temp=document.createElement('div');temp.innerHTML=htmlStr;while(temp.firstChild){frag.appendChild(temp.firstChild);}
return frag;},listener:function(){var eventMethod=window.addEventListener?"addEventListener":"attachEvent";var eventer=window[eventMethod];var messageEvent=eventMethod=="attachEvent"?"onmessage":"message";eventer(messageEvent,function(e){if(typeof e.data==="undefined"||typeof e.data!=="string"||e.data.substr(0,14)!="GlobalMojoBar:"){return;}
var data={};try{var data=JSON.parse(e.data.substr(14));}catch(err){return;}
if(typeof data.data!=="undefined")
_GAPageTools.pagedata=data.data;else _GAPageTools.pagedata=false;_GAPageTools.processState(data.action);},false);},processState:function(state,saveState){if(_GAPageTools.getSessionData("block-"+_GAData.hostname))
return;if(document.getElementById("_GACheckoutBar")){return;}
if(_GAData.version.uid===undefined||_GAData.version.uid===false){return;}
if(state=="new"){state="bar-off";}
if(state=="bar-invalid"&&(_GAData.state=="bar-on"||_GAData.state=="tab-on")){state=_GAData.state;}
if(state=="tab-on"||state=="bar-on"||state=="checkout-off-bar-on"){if(_GAData.storage&&_GAData.storage.cb_timeout){oldTs=_GAData.storage.cb_timeout;expiredTs=Math.round(Date.now()/1000)-(60*60*20);if(oldTs&&oldTs>1&&oldTs<expiredTs){state="bar-auto-reset";}}}
if(state=="bar-reset"){_GAPageTools.putSessionData("timeout-"+_GAData.hostname,(Math.round(Date.now()/1000)-(60*60*20)-30));state=_GAData.state;}
switch(state){case"drop-bar":_GAPageTools.dropBar(0,true);break;case"drop-bar-noshadow":_GAPageTools.dropBar(0,false);break;case"expand-bar":case"shrink-bar":_GAPageTools.changeBarHeight(_GAPageTools.pagedata);break;case"bar-on":_GAPageTools.injectBar(_GAPageTools.createUrl(state),"width:350px; height:330px;");_GAPageTools.sendMessage("session-notify",{type:"accepted",url:document.location.href});break;case"bar-intro":_GAPageTools.closeBar();_GAPageTools.injectBar(_GAPageTools.createUrl("bar-intro"),"top: -230px; left: 0px; width: 100% !important;  height: 230px; ");_GAPageTools.sendMessage("session-notify",{type:"accepted",url:document.location.href});_GAPageTools.sendMessage("session-notify",{type:"intro",url:document.location.href});break;case"bar-hello":_GAPageTools.closeBar();_GAPageTools.injectBar(_GAPageTools.createUrl("bar-hello"),"top: -56px; left: 0px; width: 100% !important;  height: 56px; ");_GAPageTools.sendMessage("session-notify",{type:"request",url:document.location.href});_GAPageTools.sendMessage("session-notify",{type:"hello",url:document.location.href});break;case"bar-hello-close":_GAPageTools.closeBar();state="bar-off";case"bar-off":_GAPageTools.injectBar(_GAPageTools.createUrl(state),"top: -400px; width:350px; height:370px;");_GAPageTools.sendMessage("session-notify",{type:"request",url:document.location.href});break;case"bar-invalid":_GAPageTools.injectBar(_GAPageTools.createUrl(state),"top: -56px; left: 0px; width: 100% !important;  height: 220px; ");_GAPageTools.sendMessage("session-notify",{type:"invalid",url:document.location.href});break;case"tab-on":case"tab-off":break;case"tab-on-close":_GAPageTools.closeBar();_GAPageTools.sendMessage("session-notify",{type:"accepted-show",url:document.location.href});_GAPageTools.processState("bar-on",true);break;case"tab-off-close":_GAPageTools.closeBar();_GAPageTools.sendMessage("session-notify",{type:"request-show",url:document.location.href});_GAPageTools.processState("bar-off",true);break;case"bar-off-close":_GAPageTools.closeBar();_GAPageTools.sendMessage("session-notify",{type:"request-tab",url:document.location.href});_GAPageTools.processState("tab-off",true);break;case"bar-auto-reset":_GAPageTools.sendMessage("block-afsrc");state="tab-on";saveState=true;_GAPageTools.setState(state);_GAPageTools.sendMessage("session-notify",{type:"auto-reset",url:document.location.href});_GAPageTools.sendMessage('setGAStorage',{'k':'cb_timeout','v':Math.round(Date.now()/1000)});_GAPageTools.redirect(_GAData.url);break;case"bar-off-accept":_GAPageTools.sendMessage("block-afsrc");state="bar-on";saveState=true;_GAPageTools.putSessionData("state",state);_GAPageTools.setState(state);_GAPageTools.sendMessage("session-notify",{type:"request-accepted",url:document.location.href});_GAPageTools.sendMessage('setGAStorage',{'k':'cb_timeout','v':Math.round(Date.now()/1000)});_GAPageTools.redirect(_GAData.url);break;case"bar-off-accept-iframe":_GAPageTools.sendMessage("block-afsrc");state="bar-on";saveState=true;_GAPageTools.putSessionData("state",state);_GAPageTools.setState(state);_GAPageTools.sendMessage("session-notify",{type:"request-accepted-iframe",url:document.location.href});_GAPageTools.sendMessage('setGAStorage',{'k':'cb_timeout','v':Math.round(Date.now()/1000)});_GAPageTools.sendMessage("iframe",{url:_GAData.url});_GAPageTools.closeBar();_GAPageTools.processState("bar-on",true);break;case"bar-on-close":_GAPageTools.sendMessage("session-notify",{type:"cancel-hide",url:document.location.href});_GAPageTools.closeBar();_GAPageTools.processState("tab-on",true);break;case"bar-on-complete":_GAPageTools.sendMessage("session-notify",{type:"confirm-hide",url:document.location.href});_GAPageTools.closeBar();_GAPageTools.processState("tab-on",true);break;case"bar-on-auto-close":_GAPageTools.sendMessage("session-notify",{type:"auto-hide",url:document.location.href});_GAPageTools.closeBar();_GAPageTools.processState("tab-on",true);break;case"bar-invalid-close":_GAPageTools.sendMessage("session-notify",{type:"invalid-hide",url:document.location.href});_GAPageTools.closeBar();break;case"signup":_GAPageTools.sendMessage("session-notify",{type:"ext-signup-inject",url:document.location.href});_GAPageTools.injectBar(_GAPageTools.createUrl(state),"top:-400px; width:670px; height:550px;");break;case"signup-off":_GAPageTools.sendMessage("session-notify",{type:"ext-signup-initial-close",url:document.location.href});_GAPageTools.closeBar();_GAPageTools.processState("tab-off",true);break;case"signup-start":_GAPageTools.sendMessage("session-notify",{type:"ext-signup-start",url:document.location.href});_GAPageTools.closeBar();_GAPageTools.injectOverlay();_GAPageTools.injectLoader();_GAPageTools.injectBar("https://givingassistant.org/frame?join&GAData=1","height:708px; width:670px; margin: 5% auto; left:0; right:0; top:-5%;");_GAPageTools.checkIfLoaded();break;case"signin-start":_GAPageTools.sendMessage("session-notify",{type:"ext-signin-start",url:document.location.href});_GAPageTools.closeBar();_GAPageTools.injectOverlay();_GAPageTools.injectLoader();_GAPageTools.injectBar("https://givingassistant.org/frame?sign-in&GAData=1","height:792px; width:670px; margin: 5% auto; left:0; right:0; top:-5%;");_GAPageTools.checkIfLoaded();break;case"frameClose":_GAPageTools.sendMessage("session-notify",{type:"ext-signup-inprocess-close",url:document.location.href});_GAPageTools.closeBar("_GANotification");_GAPageTools.closeBar("_GAOverlay");break;case"frameDone":_GAPageTools.closeBar("_GANotification");_GAPageTools.closeBar("_GAOverlay");state="bar-on";saveState=true;_GAPageTools.putSessionData("state",state);_GAPageTools.setState(state);_GAPageTools.sendMessage("session-notify",{type:"ext-signup-cb-activate",url:document.location.href});_GAPageTools.sendMessage('setGAStorage',{'k':'cb_timeout','v':Math.round(Date.now()/1000)});_GAPageTools.redirect(_GAData.url);break;default:break;}
if(saveState&&saveState==true)
_GAPageTools.setState(state);return;},checkIfLoaded:function(){var iframe=document.getElementById('_GANotification');iframe.onload=function(){document.getElementById("_GALoader").style.display="none";};},createUrl:function(state){var url=_GAData.bar_url+state+".html";url+="#id="+_GAData.id;url+="&state="+state;url+="&merchant="+_GAData.hostname;return url;},checkIfSignedIn:function(){if(_GAData.version.uid===undefined||_GAData.version.uid===false){_GAPageTools.processState("signup");}else{return;}},init:function(){if(!_GAData.listening){_GAPageTools.listener();_GAData.listening=true;}
_GAPageTools.processState((_GAData.force?_GAData.force:_GAData.state));}};_GAPageTools.init();